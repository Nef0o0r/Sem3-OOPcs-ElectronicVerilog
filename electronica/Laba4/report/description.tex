\section*{Цель работы} 

Ознакомиться с принципом работы четырёхразрядного семисегментного индикатора модели 4401AS-1, изучить процесс управления выводом символов с помощью анодов и катодов, разработать модуль-драйвер для работы с индикатором, провести его симуляцию в среде GTK Wave и протестировать вывод заданных значений на индикатор с использованием платы Tang Nano 9K.

\section*{Задание}

Придумать выводимое на индикатор значение (статичное или динамическое),
осуществить симуляцию модуля-драйвера индикатора, подключить индикатор к плате
и отладить его работу.

\section*{Используемые аппаратные и программные средства}
\begin{itemize}
    \item Плата Tang Nano 9K
    \item Четырёхразрядный семисегментный
индикатор 4401AS-1
    \item Среда разработки Gowin EDA
    \item Среда для симуляции GTKWave
    \item Язык описания оборудования Verilog
\end{itemize}

\chapter{Ход работы}

\section{Реализация модуля}

Модуль в качестве входа принимает тактирующий сигнал, а в качестве выходов аноды (знаки) и катоды (сегменты) индикатора.

При старте модуля инициализируется массив, хранящий состояния сегментов для вывода на индикатор цифр десятиричной системы счисленя.
Также объявляются и инициализируются счётчик задержки переклюяения между знаками (delay) индикатора и счётчик (digit index), хранящий номер активного знака.

Далее на повышении тактирующего сигнала в случае, если счетчик задержки не равен нулю, он декрементируется. В противном случае инкрементируется счетчик (digit index), хранящий номер активного знака. 
Так происходит смена текущего знака при выводе.

Каждый раз при изменении digit index в переменную active digit записываются состояния сегментов из массива цифр в соответствии с тем, какую цифру необходимо вывести на соответствующий разряд индикатора.

Полный исходный код модуля приведен в приложении 1.

\section{Блок-схема алгоритма}

\pic[H][100mm]{6}{Блок-схема программы подуля}

\section{Реализация тестбенча}

В тестбенче создается экземпляр модуля indicator.
Затем производится генерация тактирующего сигнала с частотой 100 МГц и симуляция модуля на протяжении 1000 наносекунд.
Результат симуляции сохраняется в файле indicator\_tb.vcd.

Полный исходный код тестбенча приведен в приложении 2.

\section{Симуляция}
На \hyperref[pic:2]{рисункке \ref*{pic:2}} отражена симуляция текущей программы, которая выводит на индикатор значения 3363.
А на \hyperref[pic:1]{рисункке \ref*{pic:1}} отражена симуляция программы, которая выводит на индикатор значения 1234.
Вторая симуляция предназначена для лучшего понимания работы программы.

\pic[H][170mm]{1}{Симуляция GTK Wave для вывода 1234}
\pic[H][170mm]{2}{Симуляция GTK Wave для вывода 3363}

\section{Разводка}

При разводке модуля для анодов индикатора были выбраны пины с 72 по 75 из 1 банка, так как данные выходы имеют напряжение 3.3 вольта, что необходимо для повышенной яркости сегментов индикатора. Данные пины располагаются на плате последовательно \picref{4}, что упрощает сборку схемы.

Для катодов были выбраны пины с 79 по 86 из 3 банка. Выбор обусловлен тем, что они располагаются на плате последовательно \picref{4}, что упрощает сборку схемы, и для данных выводов напряжение не имеет значения.

\pic[H][110mm]{4}{Пины платы}

Тактирующий сигнал находится на 52 пине в соответствии с документацией к плате.

\newpage

Полная разводка модуля приведена на \hyperref[pic:3]{рисункке \ref*{pic:3}}.

\pic[H][140mm]{3}{Разводка модуля}

\section{Запуск на плате}

\pic[H][100mm]{5}{}


\newpage
\section*{Вывод}

В ходе работы был разработан модуль-драйвер для управления четырёхразрядным семисегментным индикатором модели 4401AS-1 на базе платы Tang Nano 9K. Модуль корректно реализует циклическое переключение разрядов и вывод соответствующих символов за счёт управления анодами и катодами. Программа использует счётчик для смены активного разряда и выводит данные на сегменты индикатора.

В процессе работы было выявлено оптимальное значение счётчика задержки, при котором знаки переключаются корректно и при это горят достаточно ярко, это значение равно 150000.

В процессе работы были изучены принципы управления многозначными семисегментными индикаторами и особенности циклического обновления разрядов. Также был получен опыт симуляции и тестирования работы разработанного модуля в среде Gowin EDA.
